---
id: "KRX-004"
title: "Box large octocrab::Error variant to reduce Result size"
type: improvement
status: in-review
priority: medium
labels: [performance, code-quality]
created: "2026-01-25"
updated: "2026-01-25"
assignee: null
---

# Box large octocrab::Error variant to reduce Result size

## Context
Clippy warns about large error variants causing memory inefficiency. The `FetchPRs` variant in `GitHubError` contains `octocrab::Error` which is 128+ bytes.

## Current Implementation
In `src/error.rs:37`:
```rust
#[error("Failed to fetch PRs: {0}")]
FetchPRs(#[source] octocrab::Error),
```

This causes all `Result<_, GitHubError>` returns to allocate 128+ bytes on the stack regardless of whether the error path is taken.

## Proposed Improvement
Box the large error variant:
```rust
#[error("Failed to fetch PRs: {0}")]
FetchPRs(#[source] Box<octocrab::Error>),
```

## Acceptance Criteria
- [x] `FetchPRs` variant uses `Box<octocrab::Error>`
- [x] All call sites updated to box the error
- [x] Clippy warning resolved
- [x] Tests still pass

## Technical Notes
**Files affected:**
- `src/error.rs:37`
- `src/github/prs.rs:25` (fetch_merged_prs)
- `src/github/prs.rs:140` (parse_github_remote)
- `src/github/prs.rs:161` (parse_owner_repo_path)

---

## Resolution

**Completed:** 2026-01-25

### Approach
Boxed the `octocrab::Error` inside the `FetchPRs` variant to reduce the size of `Result<_, GitHubError>` on the stack. This moves the large error to the heap only when an error actually occurs.

### Changes Made
- `src/error.rs:37`: Changed `FetchPRs(#[source] octocrab::Error)` to `FetchPRs(#[source] Box<octocrab::Error>)`
- `src/github/prs.rs:35`: Updated `.map_err(GitHubError::FetchPRs)` to `.map_err(|e| GitHubError::FetchPRs(Box::new(e)))`
- `src/github/prs.rs:69`: Updated `Err(GitHubError::FetchPRs(e))` to `Err(GitHubError::FetchPRs(Box::new(e)))`

### Testing
- [x] Build passes (`cargo build --release`)
- [x] All 75 tests pass (`cargo test`)
- [x] Clippy warning `result_large_err` resolved

---
*Solved by Claude Code*
