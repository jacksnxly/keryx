---
id: "KRX-014"
title: "Fix misleading retry count comment"
type: bug
status: in-review
priority: low
labels: [documentation, comment-rot]
created: "2026-01-25"
updated: "2026-01-25"
assignee: null
---

# Fix misleading retry count comment

## Problem
The comment says "3 retries" but the constant `MAX_RETRIES = 3` with `while attempts < MAX_RETRIES` means 3 total attempts, not 3 retries (which would be 4 total).

## Current Behavior
In `src/claude/retry.rs:13`:
```rust
/// Configuration per spec: 3 retries, base 1s, max 30s.
```

And at line 20:
```rust
const MAX_RETRIES: u32 = 3;
```

With `while attempts < MAX_RETRIES`, this is 3 attempts total, not 3 retries.

## Expected Behavior
Comment should accurately describe the behavior.

## Acceptance Criteria
- [ ] Comment says "3 total attempts" instead of "3 retries"
- [ ] Or rename constant to `MAX_ATTEMPTS` for clarity

## Technical Notes
**File:** `src/claude/retry.rs:13,20`

Option 1 - Fix comment:
```rust
/// Configuration per spec: 3 total attempts, base 1s, max 30s.
```

Option 2 - Rename constant:
```rust
const MAX_ATTEMPTS: u32 = 3;
```

---

## Resolution

**Completed:** 2026-01-25

### Approach
Applied Option 2 (rename constant) plus updated all related comments and error messages for consistency.

### Changes Made
- `src/claude/retry.rs:34`: Updated comment from "3 retries" to "3 total attempts"
- `src/claude/retry.rs:35`: Renamed `MAX_RETRIES` to `MAX_ATTEMPTS`
- `src/claude/retry.rs:61,69`: Updated loop conditions to use `MAX_ATTEMPTS`
- `src/claude/retry.rs:81`: Fixed error message from "retry attempts" to "attempts"
- `src/claude/retry.rs:41`: Updated function doc from "Retries up to 3 times" to "Makes up to 3 attempts"

### Testing
- [x] Build passes (`cargo check`)
- [x] All 145 tests pass (`cargo test`)

### Acceptance Criteria
- [x] Comment says "3 total attempts" instead of "3 retries"
- [x] Renamed constant to `MAX_ATTEMPTS` for clarity

---
*Solved by Claude Code*
