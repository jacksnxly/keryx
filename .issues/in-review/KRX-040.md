---
id: "KRX-040"
title: "Use async subprocess for GitHub CLI auth"
type: improvement
status: in-review
priority: medium
labels: ["performance", "code-quality"]
created: "2026-01-26"
updated: "2026-01-26"
assignee: null
---

# Use async subprocess for GitHub CLI auth

## Problem
The `get_token_from_gh_cli` function uses blocking `std::process::Command` instead of `tokio::process::Command`, which blocks the async runtime thread.

## Current Behavior
```rust
let status = match Command::new("gh").args(["auth", "status"]).output() {
```

This is blocking I/O in an async context.

## Expected Behavior
Use `tokio::process::Command` for subprocess execution to avoid blocking the async runtime.

## Acceptance Criteria
- [x] `get_token_from_gh_cli` is async
- [x] Uses `tokio::process::Command`
- [x] Error handling preserved
- [x] No blocking I/O in async functions

## Technical Notes
**File:** `src/github/auth.rs:55-78`

For a CLI tool this is a minor issue since there's typically only one concurrent operation, but it's good practice to use async I/O consistently.

---

## Resolution

**Completed:** 2026-01-26

### Approach
Converted the blocking subprocess calls to async using `tokio::process::Command` instead of `std::process::Command`. Made both `get_github_token` and `get_token_from_gh_cli` async functions.

### Changes Made
- `src/github/auth.rs`: Changed import from `std::process::Command` to `tokio::process::Command`, made `get_github_token()` and `get_token_from_gh_cli()` async, added `.await` to `output()` calls
- `src/main.rs`: Added `.await` to `get_github_token()` call in `fetch_prs_for_repo()`

### Testing
- [x] Build passes
- [x] Type checks pass
- [x] 99 unit tests pass
- [x] 17 integration tests pass

---
*Solved by Claude Code*
