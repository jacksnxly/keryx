---
id: "KRX-031"
title: "Use semver::Version instead of String for version fields"
type: improvement
status: in-review
priority: high
labels: ["code-quality"]
created: "2026-01-26"
updated: "2026-01-26"
assignee: null
---

# Use semver::Version instead of String for version fields

## Context
Several structs use `Option<String>` for version fields instead of `Option<semver::Version>`. This weakens type safety and requires parsing at each use site instead of once at construction.

## Current Implementation

1. `src/changelog/parser.rs:11`:
```rust
pub struct ParsedChangelog {
    pub latest_version: Option<String>,  // Should be Option<Version>
    // ...
}
```

2. `src/claude/prompt.rs:13`:
```rust
pub struct ChangelogInput {
    pub previous_version: Option<String>,  // Should be Option<Version>
    // ...
}
```

## Proposed Improvement
Use `semver::Version` for these fields to enforce validity at the type level.

## Acceptance Criteria
- [x] `ParsedChangelog.latest_version` uses `Option<semver::Version>`
- [x] `ChangelogInput.previous_version` uses `Option<semver::Version>`
- [x] Parsing happens once at construction time
- [x] All call sites are updated
- [x] Serde serialization still works (via `#[serde(with = ...)]` if needed)

## Technical Notes
**Files:**
- `src/changelog/parser.rs:11`
- `src/claude/prompt.rs:13`

The `semver` crate is already a dependency. Changes needed:
1. Update struct field types
2. Parse version strings at construction time
3. Update call sites to work with `Version` type
4. Possibly add serde serialization helpers

---

## Resolution

**Completed:** 2026-01-26

### Approach
Used `semver::Version` type directly for version fields, parsing at construction time (in `extract_version_from_title`) and enabling the `serde` feature on the semver crate for serialization support in `ChangelogInput`.

### Changes Made
- `Cargo.toml`: Enabled `serde` feature on semver crate
- `src/changelog/parser.rs`: Changed `ParsedChangelog.latest_version` to `Option<Version>`, updated `extract_version_from_title` to return `Option<Version>` and parse at extraction time
- `src/claude/prompt.rs`: Changed `ChangelogInput.previous_version` to `Option<Version>`
- `src/main.rs`: Updated call site to pass `Version` directly instead of converting to string
- `tests/changelog_test.rs`: Updated assertions to compare against `Version` type

### Research Sources
- semver crate documentation: serde feature enables derive macros automatically
- Rust API guidelines on newtype patterns

### Testing
- [x] Build passes
- [x] Type checks pass
- [x] 149 tests pass

---
*Solved by Claude Code*
