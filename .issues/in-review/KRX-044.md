---
id: "KRX-044"
title: "Add --strict mode to init commands"
type: improvement
status: in-review
priority: high
labels: ["error-handling", "ux"]
created: "2026-01-26"
updated: "2026-01-26"
assignee: null
---

# Add --strict mode to init commands

## Problem
The `run_generate()` function has excellent error handling with `--strict` mode support, detailed warnings, and actionable user feedback. However, the init commands (`run_init_unreleased`, `run_init_from_history`) lack this consistency.

## Current Behavior
Init commands print warnings but continue with partial data. No way to fail-fast on errors.

```rust
Err(e) => {
    eprintln!("\x1b[33m Warning: Could not fetch PRs: {}\x1b[0m", e);
    Vec::new()
}
```

## Expected Behavior
Init commands should support `--strict` mode like `run_generate()` for consistency.

## Acceptance Criteria
- [x] `keryx init --strict` fails on PR fetch errors
- [x] `keryx init --strict` fails on commit fetch errors
- [x] Error messages include actionable guidance (like run_generate)
- [x] Without `--strict`, behavior matches current graceful degradation

## Technical Notes
**Files:**
- `src/main.rs:336-349` (run_init_unreleased PR handling)
- `src/main.rs:431-444` (run_init_from_history PR handling)

Model the error handling after `run_generate()` lines 621-644 which has excellent user feedback.

---

## Resolution

**Completed:** 2026-01-26

### Approach
Added `--strict` mode support to PR fetch error handling in both init commands, matching the pattern used in `run_generate()`. The commit fetch errors were already handled with `--strict` mode (they either fail with bail! in strict mode or continue with a warning).

### Changes Made
- `src/main.rs:346-362` (run_init_unreleased): Added strict mode check - now bails with actionable error in strict mode, or shows detailed warning with Fix/Hint guidance in non-strict mode
- `src/main.rs:458-474` (run_init_from_history): Same pattern applied - strict mode fails fast, non-strict shows comprehensive warning

### Error Message Pattern
In strict mode:
```
GitHub API error: <error>.
Hint: Use --no-prs to skip PR fetching, or check your GitHub token.
```

In non-strict mode:
```
Warning: Could not fetch pull requests
  Error: <error>
  Impact: Changelog will be generated from commits only (may be incomplete)
  Fix: Set GITHUB_TOKEN or run `gh auth login`
  Hint: Use --strict to fail instead of continuing with partial data
```

### Testing
- [x] Build passes (cargo build)
- [x] 104 unit tests pass
- [x] 87 integration tests pass
- [ ] Manual testing required

---
*Solved by Claude Code*
