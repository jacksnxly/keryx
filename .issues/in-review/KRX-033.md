---
id: "KRX-033"
title: "Add tests for fetch_commits function"
type: task
status: in-review
priority: high
labels: ["testing", "critical-gap"]
created: "2026-01-26"
updated: "2026-01-26"
assignee: jacksnxly
---

# Add tests for fetch_commits function

## Context
The `fetch_commits` function is the primary entry point for extracting commits from a repository, but it has no dedicated tests. Bugs here could cause missing commits, crashes, or incorrect ordering.

## Current State
The function at `src/git/commits.rs:121-141` is untested. Related functions like `parse_commit_message` are well-tested, but the integration point is not.

## Desired State
Comprehensive tests covering normal operation and edge cases.

## Acceptance Criteria
- [x] Test: empty range (from == to) returns empty vec
- [x] Test: range with multiple commits returns correct order
- [x] Test: range with merge commits handles correctly
- [x] Test: commits with special characters (emoji, unicode) are handled
- [x] Test: multiline messages with BREAKING CHANGE footer detected

## Technical Notes
**File to test:** `src/git/commits.rs:121-141`
**Test file:** `tests/fetch_commits_test.rs`

Use the same test infrastructure as `range_test.rs` - create temporary git repos with specific commit structures.

---

## Resolution

**Completed:** 2026-01-26

### Approach
Created a dedicated test file `tests/fetch_commits_test.rs` with 13 comprehensive tests covering all acceptance criteria and additional edge cases.

### Changes Made
- `src/git/mod.rs`: Exported `fetch_commits` function for use in tests
- `tests/common/mod.rs`: Added `merge_commit` helper for testing merge scenarios
- `tests/fetch_commits_test.rs`: Created new test file with 13 tests

### Tests Added
1. `test_fetch_commits_empty_range_same_commit` - Empty range returns empty vec
2. `test_fetch_commits_single_commit_range` - Single commit in range
3. `test_fetch_commits_multiple_commits_range` - Multiple commits, correct count
4. `test_fetch_commits_preserves_order` - Verifies newest-first ordering
5. `test_fetch_commits_with_merge_commit` - Merge commits handled correctly
6. `test_fetch_commits_parses_conventional_commits` - Conventional commit parsing
7. `test_fetch_commits_handles_non_conventional_messages` - Non-conventional graceful handling
8. `test_fetch_commits_has_timestamps` - Timestamps are recent and set
9. `test_fetch_commits_with_empty_message` - Empty/whitespace messages don't crash
10. `test_fetch_commits_with_multiline_message` - BREAKING CHANGE in footer detected
11. `test_fetch_commits_with_special_characters_in_message` - Emoji/unicode support
12. `test_fetch_commits_long_commit_history` - 50 commits handled correctly
13. `test_fetch_commits_returns_full_hashes` - Full 40-char SHA-1 hashes

### Testing
- [x] All 13 new tests pass
- [x] All 80+ existing tests still pass
- [x] Build passes

---
*Solved by Claude Code*
