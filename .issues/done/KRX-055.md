# [KRX-055] Fix Confidence enum doc comments to match scoring algorithm

**Type:** bug
**Priority:** medium
**Status:** done
**Labels:** documentation, comment-rot
**Created:** 2026-01-26
**Updated:** 2026-01-27
**Branch:** feat/agentic-verification

---

## Problem

The doc comments on `Confidence` enum variants don't match the actual scoring algorithm in `calculate_confidence()`.

## Current Documentation

```rust
// src/verification/evidence.rs:80-85
pub enum Confidence {
    /// High confidence - multiple sources, no stubs.
    High,
    /// Medium confidence - some evidence found.
    Medium,
    /// Low confidence - minimal evidence or stub indicators.
    Low,
}
```

## Actual Algorithm

```rust
// src/verification/scanner.rs:571-614
fn calculate_confidence(...) -> Confidence {
    let mut score: i32 = 50;  // Start at 50

    // Boost for keyword matches
    for km in keyword_matches {
        if km.occurrence_count > 0 { score += 10; }
        if km.appears_complete { score += 10; }
        if km.files_found.len() > 2 { score += 5; }
    }

    // Penalty for stub indicators
    score -= (stub_indicators.len() as i32) * 15;

    // Penalty for count mismatches
    for check in count_checks {
        if !check.matches { score -= 20; }
    }

    // No keyword matches is suspicious
    if keyword_matches.is_empty() { score -= 30; }

    if score >= 70 { Confidence::High }
    else if score >= 40 { Confidence::Medium }
    else { Confidence::Low }
}
```

The comments say "no stubs" for High, but the algorithm allows stubs (just penalized). "Multiple sources" isn't explicit - it's score-based.

## Acceptance Criteria

- [ ] Update `Confidence::High` doc to reflect score >= 70 criteria
- [ ] Update `Confidence::Medium` doc to reflect score 40-69 criteria
- [ ] Update `Confidence::Low` doc to reflect score < 40 criteria
- [ ] Comments describe what contributes to each level

## Technical Notes

**Suggested fix:**

```rust
pub enum Confidence {
    /// High confidence (score >= 70).
    /// Strong evidence: many keyword matches in multiple files,
    /// complete implementations (no stub indicators nearby),
    /// and no count mismatches.
    High,

    /// Medium confidence (score 40-69).
    /// Moderate evidence: some keyword matches found but may have
    /// stub indicators, single-file matches, or minor count issues.
    Medium,

    /// Low confidence (score < 40).
    /// Weak evidence: minimal or no keyword matches, multiple stub
    /// indicators, significant count mismatches, or all combined.
    Low,
}
```

---

## Resolution

**Completed:** 2026-01-27

### Approach
Updated the doc comments on the `Confidence` enum to accurately reflect the score-based calculation algorithm in `calculate_confidence()`. The new comments include:
- Score thresholds for each confidence level (>=70, 40-69, <40)
- What factors contribute to each level (keyword matches, stub indicators, count checks)
- Added module-level doc comment explaining the scoring system

### Changes Made
- `src/verification/evidence.rs`: Updated doc comments on `Confidence` enum variants to match the actual scoring algorithm

### Acceptance Criteria
- [x] Update `Confidence::High` doc to reflect score >= 70 criteria
- [x] Update `Confidence::Medium` doc to reflect score 40-69 criteria
- [x] Update `Confidence::Low` doc to reflect score < 40 criteria
- [x] Comments describe what contributes to each level

### Testing
- [x] Build passes (cargo build)
- [x] All 246 tests pass (cargo test)
- [x] Documentation accurately reflects algorithm in scanner.rs:725-768

---
*Solved by Claude Code*
