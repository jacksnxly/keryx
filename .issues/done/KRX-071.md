---
id: "KRX-071"
title: "Fix debug-level logging for file read errors in array counting"
type: bug
status: done
priority: medium
labels: ["error-handling", "silent-failure"]
created: "2026-01-27"
updated: "2026-01-27"
assignee: "jacksnxly"
---

# Fix debug-level logging for file read errors in array counting

## Problem
When a file can't be read for array counting, it's logged at `debug!` level and silently skipped. This could hide permission issues or encoding problems that affect count verification accuracy.

## Current Behavior
File read errors during array counting are logged at `debug!` level:
```rust
Err(e) => {
    debug!(
        "Cannot read file '{}' for array counting: {}",
        file, e
    );
}
```

Users running without `-v` flag never see these errors.

## Expected Behavior
Use `warn!` for unexpected errors (permission denied, I/O errors) and `debug!` only for benign cases like race conditions (file doesn't exist after rg found it).

## Steps to Reproduce
1. Run verification on a codebase with permission-restricted files containing arrays
2. Observe no warning in output about skipped files
3. Count verification may be incomplete

**Environment:** Any environment with files that have restricted permissions

## Acceptance Criteria
- [ ] Permission denied errors logged at `warn!` level
- [ ] I/O errors logged at `warn!` level
- [ ] File not found (race condition) logged at `debug!` level
- [ ] Users aware when count verification is incomplete

## Technical Notes
**Location:** `src/verification/scanner.rs:648-660`

Distinguish error types:
```rust
Err(e) => {
    if e.kind() == std::io::ErrorKind::NotFound {
        debug!("File '{}' no longer exists: {}", file, e);
    } else {
        warn!("Cannot read file '{}' for array counting: {}", file, e);
    }
}
```

---

## Resolution

**Completed:** 2026-01-27

### Approach
Distinguished I/O error kinds in the file read error handler for array counting. `NotFound` errors (benign race conditions where rg finds a file that is deleted before we read it) remain at `debug!` level. All other errors (permission denied, I/O failures, encoding issues) are elevated to `warn!` level so users see them without needing `-v`.

### Changes Made
- `src/verification/scanner.rs:674-680`: Replaced blanket `debug!` log with error-kind check â€” `NotFound` stays `debug!`, everything else becomes `warn!`

### Testing
- [x] Build passes (`cargo build`)
- [x] All 269 tests pass (`cargo test`)
- [ ] Manual testing required (permission-restricted file scenario)

---
*Solved by Claude Code*
