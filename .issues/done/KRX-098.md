---
id: "KRX-098"
title: "Add user-facing feedback for silent split analysis fallbacks"
type: improvement
status: done
priority: medium
labels: ["ux", "error-handling", "silent-failure"]
created: "2026-02-02"
updated: "2026-02-02"
assignee: null
---

# Add user-facing feedback for silent split analysis fallbacks

## Context
When split analysis fails due to JSON parse errors or validation failures, the code falls back to a single commit with only `debug!`-level logging. The user sees "Checking if changes should be split into multiple commits..." then silence. The `Err(e)` branch already has good user feedback (eprintln to stderr), but the `Ok(None)` paths for parse/validation failures do not.

## Current Implementation
- `src/commit/analysis.rs:96-101`: JSON parse failure logs at `debug!` and returns `Ok(None)` -- invisible without `--verbose`
- `src/commit/analysis.rs:115-118`: Validation failure logs `warn!` but no stderr output to user
- Caller in `main.rs` treats both as "no split needed" with only verbose debug message

## Proposed Improvement
1. Upgrade JSON parse failure logging from `debug!` to `warn!`
2. Add `eprintln!` messages for both parse and validation failures, matching the pattern used by the `Err(e)` branch in `run_commit`
3. Messages should be yellow/warning colored and mention "falling back to single commit"

## Acceptance Criteria
- [ ] JSON parse failures in `analyze_split` produce a user-visible stderr message
- [ ] Validation failures in `analyze_split` produce a user-visible stderr message
- [ ] Messages match the style of the existing `Err(e)` branch (yellow, "falling back to single commit")
- [ ] `--verbose` still shows additional detail
- [ ] Existing tests pass

## Technical Notes
- File: `src/commit/analysis.rs`, lines 96-101 and 115-118
- Follow the pattern at `main.rs` lines 819-828 (the `Err(e)` branch)
- Found during PR review of `feat/commit-messages`

---

## Resolution

**Completed:** 2026-02-02

### Approach
Added user-visible `eprintln!` warnings to the two silent fallback paths in `analyze_split`, matching the existing yellow warning style used by the `Err(e)` branch in `main.rs`.

### Changes Made
- `src/commit/analysis.rs:98-107`: JSON parse failure — upgraded `debug!` to `warn!`, added yellow `eprintln!` warning ("response could not be parsed, falling back to single commit"), gated raw response debug output behind `verbose` flag
- `src/commit/analysis.rs:122-130`: Validation failure — added yellow `eprintln!` warning ("failed validation, falling back to single commit"), added `--verbose` detail showing the specific validation error

### Testing
- [x] Build passes (`cargo build` — 0 errors, 0 warnings)
- [x] All 398 tests pass (`cargo test` — 0 failures)
- [ ] Manual testing required

---
*Solved by Claude Code*
