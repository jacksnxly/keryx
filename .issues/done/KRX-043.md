---
id: "KRX-043"
title: "Replace unwrap_or_default with explicit error handling in init commands"
type: bug
status: done
priority: high
labels: ["silent-failure", "error-handling"]
created: "2026-01-26"
updated: "2026-01-26"
assignee: null
---

# Replace unwrap_or_default with explicit error handling in init commands

## Problem
In `run_init_from_history`, commit fetching failures are silently converted to empty vectors with `unwrap_or_default()`. Version sections appear empty with no indication of failure.

## Current Behavior
```rust
let commits = if let Some(from_oid) = prev_oid {
    fetch_commits(repo, from_oid, tag.oid)
        .unwrap_or_default()  // Silent failure!
} else {
    let root_oid = find_root_commit(repo)
        .unwrap_or(tag.oid);  // Another silent failure!
    fetch_commits(repo, root_oid, tag.oid)
        .unwrap_or_default()  // Silent failure!
};
```

## Expected Behavior
Log warnings when commit fetching fails so users understand why version sections may be empty.

## Acceptance Criteria
- [x] Warning logged when `fetch_commits` fails
- [x] Warning logged when `find_root_commit` fails
- [x] Warning includes tag name for context
- [x] `--strict` mode fails on these errors

## Technical Notes
**Files:**
- `src/main.rs:456-464` (run_init_from_history)
- `src/main.rs:524-525` (unreleased commits)

Same issue exists for unreleased commits fetching.

---

## Resolution

**Completed:** 2026-01-26

### Approach
Replaced all `unwrap_or_default()` and `unwrap_or()` calls with explicit `match` statements that:
1. Log warnings with context (tag name) when errors occur
2. Fail fast with `bail!()` when `--strict` mode is enabled
3. Fall back to empty vectors or default values in non-strict mode

### Changes Made
- `src/main.rs:459-488`: Replaced silent failures in the main loop of `run_init_from_history` with explicit error handling for both `fetch_commits` and `find_root_commit`
- `src/main.rs:551-560`: Replaced silent failure for unreleased commits fetching with explicit error handling

### Testing
- [x] Build passes
- [x] 104 unit tests pass
- [x] All integration tests pass

---
*Solved by Claude Code*
