---
id: "KRX-021"
title: "Fix silent tag UTF-8 decode failures in get_all_tags"
type: bug
status: done
priority: urgent
labels: ["silent-failure", "error-handling", "critical-gap"]
created: "2026-01-26"
updated: "2026-01-26"
assignee: null
---

# Fix silent tag UTF-8 decode failures in get_all_tags

## Problem
Tags with non-UTF-8 names are silently skipped without any logging or user notification. If a skipped tag happens to be the latest version tag, the next version calculation will be wrong.

## Current Behavior
In `src/git/tags.rs:33-56`, when a tag name cannot be decoded as UTF-8, the tag is silently skipped:

```rust
if let Ok(name_str) = std::str::from_utf8(name_bytes) {
    // ... process tag
}
true // Continue iteration - no warning logged
```

## Expected Behavior
Log a warning when a tag cannot be decoded so users are aware that a tag was ignored. This prevents silent incorrect version calculations.

## Steps to Reproduce
1. Create a git repo with a tag that has non-UTF-8 characters in its name
2. Run keryx to generate changelog
3. Observe that the tag is silently ignored with no warning

**Environment:** All platforms

## Acceptance Criteria
- [x] Warning is logged when a tag name cannot be decoded as UTF-8
- [x] Warning includes the tag OID for identification
- [x] User can see the warning in normal (non-verbose) output

## Technical Notes
**File:** `src/git/tags.rs:33-56`

Suggested fix:
```rust
if let Ok(name_str) = std::str::from_utf8(name_bytes) {
    // ... process
} else {
    tracing::warn!(
        "Skipping tag with OID {} - name is not valid UTF-8",
        oid
    );
}
```

---

## Resolution

**Completed:** 2026-01-26

### Approach
Added warning logging to the `get_all_tags` function to notify users when a tag with non-UTF-8 name is skipped. This follows the same pattern used in other git modules (`commits.rs`, `range.rs`) for consistency.

### Changes Made
- `src/git/tags.rs:5`: Added `use tracing::warn;` import
- `src/git/tags.rs:56-61`: Added `else` branch to log warning when UTF-8 decoding fails, including the tag OID for identification

### Research Sources
- Existing codebase patterns in `src/git/commits.rs` and `src/git/range.rs`

### Testing
- [x] Build passes (`cargo build`)
- [x] Type checks pass (`cargo check`)
- [x] All 146 tests pass (`cargo test`)
- [ ] Manual testing required (create tag with non-UTF-8 name)

---
*Solved by Claude Code*
