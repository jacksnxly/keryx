---
id: "KRX-078"
title: "Add RG_CODE_TYPE filter to find_stub_indicators_near_keyword"
type: bug
status: in-review
priority: high
labels: ["bug", "silent-failure"]
created: "2026-01-27"
updated: "2026-01-28"
assignee: null
---

# Add RG_CODE_TYPE filter to find_stub_indicators_near_keyword

## Problem
`search_keyword` uses `build_rg_keyword_command` which includes `RG_CODE_TYPE` (restricting to source code files). However, `find_stub_indicators_near_keyword` builds its own ripgrep command and does **not** include `RG_CODE_TYPE`. This means stub indicators are searched across all file types including markdown, documentation, and config files, leading to false positives.

## Current Behavior
A `TODO` comment in a `README.md` or documentation file incorrectly lowers the confidence score for a feature that is fully implemented in source code.

## Expected Behavior
Stub indicator search should only scan source code files, matching the behavior of `search_keyword`.

## Acceptance Criteria
- [x] `find_stub_indicators_near_keyword` includes `RG_CODE_TYPE` arguments
- [ ] Or refactored to use `build_rg_keyword_command` for consistency
- [x] TODOs in markdown/docs files do not affect verification confidence

## Technical Notes
- **File:** `src/verification/scanner.rs:349-355`
- `RG_CODE_TYPE` is defined as a const and used in `build_rg_keyword_command`
- Also consider passing already-found files from `search_keyword` instead of re-running the file search (eliminates a redundant subprocess per keyword)

---

## Resolution

**Completed:** 2026-01-28

### Approach
Added the `RG_CODE_TYPE` filter to `find_stub_indicators_near_keyword` to match the behavior of `search_keyword`. This ensures that stub indicators (TODO, FIXME, etc.) are only searched in source code files, not in markdown, documentation, or config files.

### Changes Made
- `src/verification/scanner.rs:362`: Added `cmd.args(RG_CODE_TYPE);` to the ripgrep command in `find_stub_indicators_near_keyword`

### Technical Details
The fix adds the `RG_CODE_TYPE` constant (which filters to `*.{rs,ts,tsx,js,jsx,py,go,java,c,cpp,h,hpp}` files) to the ripgrep command that finds files containing the keyword before searching for stub patterns. This ensures consistency with `build_rg_keyword_command` used by `search_keyword`.

### Testing
- [x] Build passes (`cargo build --release`)
- [x] All 169 unit tests pass
- [x] All integration tests pass
- [ ] Manual testing required

---
*Solved by Claude Code*
