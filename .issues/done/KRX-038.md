---
id: "KRX-038"
title: "Add logging for version parse errors in changelog parser"
type: bug
status: done
priority: high
labels: ["silent-failure", "error-handling"]
created: "2026-01-26"
updated: "2026-01-26"
assignee: null
---

# Add logging for version parse errors in changelog parser

## Problem
Version parsing errors are completely discarded with `.ok()`. If a changelog has malformed version strings, users get no indication that detection failedâ€”leading to confusing duplicate version warnings.

## Current Behavior
```rust
Version::parse(version_str).ok()
```

When parsing fails, `None` is returned silently. Users may see "version already exists" errors for versions that exist in the changelog but weren't parsed.

## Expected Behavior
Log at debug level when version parsing fails so users can understand why version detection may be incomplete.

## Steps to Reproduce
1. Create a changelog with a malformed version like `## [1.2] - 2024-01-01` (missing patch version)
2. Run `keryx` to add version 1.2.0
3. Tool doesn't detect existing "1.2" as duplicate

**Environment:** Any

## Acceptance Criteria
- [x] Debug log when version string fails to parse as semver
- [x] Log includes the malformed version string for debugging
- [x] Parsing continues gracefully for other versions

## Technical Notes
**File:** `src/changelog/parser.rs:82`

Suggested fix:
```rust
match Version::parse(version_str) {
    Ok(v) => Some(v),
    Err(e) => {
        debug!(
            "Could not parse '{}' as semver: {}. Skipping this version.",
            version_str, e
        );
        None
    }
}
```

Also affects `src/git/commits.rs:111` for commit type parsing.

---

## Resolution

**Completed:** 2026-01-26

### Approach
Added debug-level logging using the `tracing` crate for both silent failure locations identified in the issue. The logging provides visibility into parsing failures without changing the existing behavior (parsing continues gracefully).

### Changes Made
- `src/changelog/parser.rs`: Added `use tracing::debug;` import and replaced `.ok()` with match expression that logs on parse failure (lines 82-92)
- `src/git/commits.rs`: Extended existing `tracing` import to include `debug` and replaced `.ok()` with match expression that logs on parse failure (lines 120-128)

### Research Sources
- None required - straightforward fix using existing `tracing` crate already in use throughout the codebase

### Testing
- [x] Build passes (`cargo build --release`)
- [x] 95 tests pass (`cargo test`)
- [ ] Manual testing required (run with `RUST_LOG=debug` to verify logs appear)

---
*Solved by Claude Code*
