---
id: "KRX-032"
title: "Use NonZeroU64 for PullRequest number field"
type: improvement
status: done
priority: medium
labels: ["code-quality"]
created: "2026-01-26"
updated: "2026-01-26"
assignee: null
---

# Use NonZeroU64 for PullRequest number field

## Context
The `PullRequest` struct uses `u64` for the number field, which allows 0 - an invalid PR number. Using `NonZeroU64` would make invalid states unrepresentable at the type level.

## Current Implementation
In `src/github/prs.rs:12`:

```rust
pub struct PullRequest {
    pub number: u64,  // Allows 0, which is invalid
    // ...
}
```

## Proposed Improvement
Use `std::num::NonZeroU64` to enforce that PR numbers are always positive.

## Acceptance Criteria
- [x] `PullRequest.number` uses `NonZeroU64`
- [x] Construction fails fast if API returns 0 (shouldn't happen)
- [x] Serde deserialization still works
- [x] All call sites are updated

## Technical Notes
**File:** `src/github/prs.rs:12`

Suggested change:
```rust
use std::num::NonZeroU64;

pub struct PullRequest {
    pub number: NonZeroU64,
    // ...
}
```

Consider also creating a `PrNumber` newtype for even stronger typing:
```rust
#[derive(Debug, Clone, Copy, Serialize, Deserialize)]
pub struct PrNumber(NonZeroU64);
```

---

## Resolution

**Completed:** 2026-01-26

### Approach
Used `std::num::NonZeroU64` for the `PullRequest.number` field to make invalid PR numbers (0) unrepresentable at the type level. Added defensive validation when constructing `PullRequest` from the GitHub API response, skipping any PRs with number 0 (which should never happen but is now handled gracefully).

### Changes Made
- `src/github/prs.rs:3`: Added `use std::num::NonZeroU64;` import
- `src/github/prs.rs:14`: Changed `pub number: u64` to `pub number: NonZeroU64`
- `src/github/prs.rs:138-148`: Added `NonZeroU64::new()` conversion with error handling that skips invalid PRs and logs a warning
- `src/github/prs.rs:333-351`: Added unit tests for serde serialization/deserialization with NonZeroU64
- `tests/github_prs_test.rs:683-713`: Added integration test `test_skips_zero_pr_number` verifying PRs with number 0 are skipped

### Testing
- [x] Build passes (`cargo check`)
- [x] 150 tests pass (`cargo test`)
- [x] No clippy warnings (`cargo clippy`)
- [x] New unit tests verify serde round-trip works correctly
- [x] New unit test verifies deserialization rejects number=0
- [x] New integration test verifies PRs with number=0 are skipped

---
*Solved by Claude Code*
