---
id: "KRX-090"
title: "Add user-visible warnings when LLM version bump falls back"
type: improvement
status: in-review
priority: high
labels: ["ux", "error-handling", "silent-failure"]
created: "2026-02-02"
updated: "2026-02-02"
assignee: null
---

# Add user-visible warnings when LLM version bump falls back

## Context
`determine_version_with_llm` catches all errors and falls back silently to algorithmic bumping. It uses `tracing::warn!` which goes to stderr via the subscriber, but there is no `eprintln!` user-facing output like `report_llm_fallback_if_any` provides for changelog generation. Users expect LLM-powered analysis and silently receive algorithmic bumps.

Additionally, provider failover is logged at `debug!` level inside an `if verbose` guard (line 170-181), inconsistent with `report_llm_fallback_if_any` in `main.rs` which prints a prominent yellow warning.

## Current Implementation
- Three fallback paths in `determine_version_with_llm` (lines 150-202) use only `tracing::warn!`
- Provider failover is gated behind `if verbose` + `debug!` level
- No `eprintln!` or colored output for LLM bump fallbacks
- `parse_version_bump_response` uses `.ok()?` at line 107, discarding specific JSON parse errors

## Proposed Improvement
1. Add `eprintln!` user-facing warnings when falling back, matching the pattern in `report_llm_fallback_if_any`
2. Log provider failover at `warn!` level unconditionally (remove `if verbose` guard)
3. Replace `.ok()?` in `parse_version_bump_response` with explicit error logging via `debug!` showing the specific parse failure reason
4. Include enough detail for users to diagnose the issue (provider name, error summary)

## Acceptance Criteria
- [x] User sees a visible warning when LLM version bump falls back to algorithmic
- [x] Provider failover is logged at `warn!` level without `if verbose` guard
- [x] JSON parse failures in `parse_version_bump_response` log the specific error at `debug!` level
- [x] Warning output is consistent with existing `report_llm_fallback_if_any` style

## Technical Notes
- File: `src/version/llm_bump.rs:107, 150-202`
- Reference pattern: `report_llm_fallback_if_any` in `src/main.rs:1018`
- Flagged by: silent-failure-hunter

---

## Resolution

**Completed:** 2026-02-02

### Approach
Added user-facing `eprintln!` warnings with yellow ANSI coloring (matching `report_llm_fallback_if_any` style) to all three fallback paths in `determine_version_with_llm`. Upgraded provider failover logging from `debug!` behind `if verbose` to unconditional `warn!`. Replaced `.ok()?` in `parse_version_bump_response` with explicit `match` that logs the specific JSON parse error at `debug!` level.

### Changes Made
- `src/version/llm_bump.rs`: Added `eprintln!` warnings to all 3 fallback paths (prompt error, LLM call failure, parse failure); removed `if verbose` guard from provider failover and upgraded to `warn!`; replaced `.ok()?` with explicit error logging via `debug!`

### Research Sources
- Existing pattern: `report_llm_fallback_if_any` in `src/main.rs:1018`

### Testing
- [x] Build passes
- [x] All 227 unit tests pass
- [x] All integration tests pass
- [ ] Manual testing required

---
*Solved by Claude Code*
