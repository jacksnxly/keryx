---
id: "KRX-087"
title: "Replace stringly-typed StubIndicator.indicator with StubType enum"
type: improvement
status: in-review
priority: medium
labels: ["code-quality"]
created: "2026-01-29"
updated: "2026-01-29"
assignee: null
---

# Replace stringly-typed StubIndicator.indicator with StubType enum

## Context
The `StubIndicator` struct uses a `String` for the `indicator` field, which is populated from `STUB_PATTERNS` in scanner.rs. This is stringly-typed when it should be an enum for type safety. The type design analysis rated this 3/10 for invariant expression.

Identified during PR review of feat/agentic-verification branch.

## Current Implementation
At `src/verification/evidence.rs:196-207`:
```rust
pub struct StubIndicator {
    pub file: String,
    pub line: usize,
    pub indicator: String,  // Stringly-typed
    pub context: String,
}
```

The `indicator` field is populated from pattern matching in `scanner.rs:387-392`, with a fallback string "stub" when the pattern isn't matched.

Known stub patterns from `scanner.rs:88-101`:
- TODO, FIXME, XXX, HACK
- unimplemented!, todo!
- panic!("not implemented")
- etc.

## Proposed Improvement
Create a `StubType` enum:

```rust
pub enum StubType {
    Todo,
    Fixme,
    Xxx,
    Hack,
    Unimplemented,
    TodoMacro,
    Panic,
    Placeholder,
    NotImplemented,
    Unknown,  // Fallback for unrecognized patterns
}

pub struct StubIndicator {
    pub file: String,
    pub line: usize,
    pub indicator: StubType,  // Now type-safe
    pub context: String,
}
```

## Acceptance Criteria
- [x] `StubType` enum created with all known stub indicator types
- [x] `StubIndicator.indicator` field changed to `StubType`
- [x] Scanner code updated to construct proper enum variants
- [x] Serialization produces lowercase strings (e.g., `"todo"`, `"fixme"`)
- [x] Existing tests pass with new type

## Technical Notes
- Location: `src/verification/evidence.rs:196-207`
- Related: `STUB_PATTERNS` at `scanner.rs:88-101`
- Related: Construction at `scanner.rs:387-392`
- Type design rating: 3/10 (from PR review)

---

## Resolution

**Completed:** 2026-01-29

### Approach
Created a `StubType` enum with 13 variants covering all known stub patterns plus an `Unknown` fallback. Used `#[serde(rename_all = "lowercase")]` for lowercase JSON serialization, matching the existing `Confidence` enum pattern. Changed `STUB_PATTERNS` from `&[&str]` to `&[(&str, StubType)]` to co-locate patterns with their enum variants.

### Changes Made
- `src/verification/evidence.rs`: Added `StubType` enum with `Display` impl, changed `StubIndicator.indicator` to `StubType`
- `src/verification/mod.rs`: Exported `StubType` publicly
- `src/verification/scanner.rs`: Updated imports, changed `STUB_PATTERNS` to tuple array, updated pattern iteration and construction
- `tests/verification_integration_test.rs`: Updated test to use `StubType` enum instead of string matching

### Testing
- [x] Build passes (`cargo build`)
- [x] All 298 unit tests pass (`cargo test`)
- [x] New serialization tests verify lowercase JSON output

---
*Solved by Claude Code*
