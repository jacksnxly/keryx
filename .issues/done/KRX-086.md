---
id: "KRX-086"
title: "Add warnings field to VerificationEvidence for degraded evidence signaling"
type: improvement
status: in-review
priority: medium
labels: ["error-handling", "code-quality"]
created: "2026-01-29"
updated: "2026-01-29"
assignee: null
---

# Add warnings field to VerificationEvidence for degraded evidence signaling

## Context
The `gather_verification_evidence` function returns `VerificationEvidence` (not `Result`), so all errors from sub-operations are logged but the caller has no way to know if evidence gathering was significantly degraded. This is by design for "best-effort" gathering, but callers cannot distinguish between "evidence is complete" and "evidence is partial due to errors".

Identified during PR review of feat/agentic-verification branch.

## Current Implementation
At `src/verification/scanner.rs:121-142`:
```rust
pub fn gather_verification_evidence(
    entries: &[ChangelogEntry],
    repo_path: &Path,
) -> VerificationEvidence {  // Not Result<VerificationEvidence>
```

Hidden errors include:
- All `get_project_structure` failures (tree/ls both fail)
- All `gather_key_files` read failures
- All `analyze_entry` internal failures

In `main.rs:1046`, the caller uses evidence without knowing if it's degraded.

## Proposed Improvement
Add a `warnings` or `degradation_reasons` field to `VerificationEvidence`:

```rust
pub struct VerificationEvidence {
    pub entries: Vec<EntryEvidence>,
    pub project_structure: Option<String>,
    pub project_structure_source: Option<String>,
    pub key_files: Vec<KeyFileContent>,
    pub warnings: Vec<String>,  // NEW: Track issues during gathering
}
```

Then callers can check `evidence.warnings.is_empty()` to decide how to handle degraded evidence.

## Acceptance Criteria
- [x] `VerificationEvidence` has a `warnings` field (Vec<String> or similar)
- [x] Issues encountered during evidence gathering are recorded in warnings
- [x] Warnings are included in JSON output when `--output-format json`
- [x] Callers can check if evidence gathering was degraded

## Technical Notes
- Location: `src/verification/evidence.rs:8-18`
- Related: `gather_verification_evidence` at `scanner.rs:121-142`
- Related: Usage in `main.rs:1046`
- Severity: Medium (from PR review)

---

## Resolution

**Completed:** 2026-01-29

### Approach
Added a `warnings: Vec<String>` field to `VerificationEvidence` struct to track issues during evidence gathering. Updated all sub-operations (`get_project_structure`, `gather_key_files`, `analyze_entry`) to return warnings which are collected by `gather_verification_evidence`. Added helper methods `add_warning()` and `is_degraded()` for ergonomic use.

### Changes Made
- `src/verification/evidence.rs`:
  - Added `warnings: Vec<String>` field to `VerificationEvidence`
  - Added `#[serde(default, skip_serializing_if = "Vec::is_empty")]` for clean JSON
  - Added `add_warning()` helper method
  - Added `is_degraded()` helper method to check if warnings exist
  - Updated `empty()` to initialize warnings as empty vec
  - Added tests for warnings functionality and serialization

- `src/verification/scanner.rs`:
  - Updated `gather_verification_evidence` to collect warnings from sub-operations
  - Updated `analyze_entry` to return `(EntryEvidence, Vec<String>)`
  - Updated `get_project_structure` to return `(Option<String>, Option<String>, Option<String>)` with warning
  - Updated `gather_key_files` to return `(Vec<KeyFileContent>, Vec<String>)` with warnings
  - Updated tests for `gather_key_files` to handle new return type

### Testing
- [x] Build passes (`cargo build`)
- [x] All 180 tests pass (`cargo test`)
- [x] New tests added for warnings functionality

---
*Solved by Claude Code*
