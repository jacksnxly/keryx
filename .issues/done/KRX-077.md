---
id: "KRX-077"
title: "Fix hardcoded Path::new(\".\") in verify_changelog_entries to use repo root"
type: bug
status: in-review
priority: high
labels: ["bug"]
created: "2026-01-27"
updated: "2026-01-28"
assignee: null
---

# Fix hardcoded Path::new(".") in verify_changelog_entries to use repo root

## Problem
`verify_changelog_entries` uses `Path::new(".")` as the repo path, meaning it always scans from the current working directory. The rest of the code uses `git2::Repository::discover(".")` which resolves to the actual repo root. If a user runs keryx from a subdirectory, the verification scanner searches the wrong location, producing incomplete or incorrect results.

## Current Behavior
```rust
// main.rs:859
let repo_path = Path::new(".");
let evidence = gather_verification_evidence(&draft.entries, repo_path);
```

Running `keryx` from `project/src/` would scan only `src/` instead of the full repository.

## Expected Behavior
Verification should scan from the repository root regardless of the user's current working directory.

## Acceptance Criteria
- [x] Pass the repository root path (from `repo.workdir()`) to `verify_changelog_entries`
- [x] Forward the repo root to `gather_verification_evidence`
- [x] Verification produces correct results when run from a subdirectory

## Technical Notes
- **File:** `src/main.rs:859`
- `repo.workdir()` returns `Option<&Path>` -- handle the `None` case (bare repo) gracefully

---

## Resolution

**Completed:** 2026-01-28

### Approach
Changed `verify_changelog_entries` to accept a `repo_path` parameter instead of hardcoding `Path::new(".")`. The repo path is now obtained from `repo.workdir()` at the call sites, with proper error handling for bare repositories.

### Changes Made
- `src/main.rs:866-870`: Updated function signature to accept `repo_path: &std::path::Path` parameter
- `src/main.rs:426-430`: First call site (in `run_init_unreleased`) now passes `repo.workdir()` with bare repo error handling
- `src/main.rs:815-819`: Second call site (in `run_generate`) now passes `repo.workdir()` with bare repo error handling

### Testing
- [x] Build passes (`cargo build`)
- [x] All 168 tests pass (`cargo test`)
- [ ] Manual testing required (run keryx from subdirectory)

---
*Solved by Claude Code*
