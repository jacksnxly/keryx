---
id: "KRX-065"
title: "Add Result type to search_keyword for proper error propagation"
type: improvement
status: done
priority: high
labels: ["error-handling", "silent-failure"]
created: "2026-01-27"
updated: "2026-01-27"
assignee: null
---

# Add Result type to search_keyword for proper error propagation

## Context
The `search_keyword` function returns `None` for multiple distinct error conditions, making them indistinguishable to the caller. Users can't tell if evidence is missing because:
- The keyword genuinely wasn't found (normal)
- ripgrep failed with an unexpected error
- ripgrep isn't installed
- There was an I/O error

## Current State
All errors result in `None` being returned. While warnings are logged, the caller has no programmatic way to know if an error occurred vs. no matches found.

## Desired State
Return `Result<Option<SearchResult>, ScannerError>` to distinguish:
- `Ok(None)` - No matches found (normal, expected)
- `Ok(Some(result))` - Matches found
- `Err(error)` - Error occurred during search

## Acceptance Criteria
- [x] `search_keyword` returns `Result<Option<SearchResult>, ScannerError>`
- [x] Callers can distinguish errors from no-results
- [x] First critical error can be surfaced to user (not silently logged)
- [x] Existing graceful degradation behavior preserved when `--strict` not used

## Technical Notes
**Location:** `src/verification/scanner.rs:195-225`

Related to adding a `ScannerError` type that wraps different error conditions:
- `RipgrepFailed { exit_code, stderr }`
- `RipgrepNotFound`
- `IoError(String)`

---

## Resolution

**Completed:** 2026-01-27

### Approach
Added a `ScannerError` enum to `src/error.rs` and changed `search_keyword` from returning `Option<SearchResult>` to `Result<Option<SearchResult>, ScannerError>`. The caller in `analyze_entry` now matches on all three cases: `Ok(Some(..))` for found matches, `Ok(None)` for no matches, and `Err(..)` for errors (logged as warnings, preserving graceful degradation).

### Changes Made
- `src/error.rs`: Added `ScannerError` enum with `RipgrepFailed`, `RipgrepNotFound`, and `IoError` variants
- `src/verification/scanner.rs`: Changed `search_keyword` return type to `Result<Option<SearchResult>, ScannerError>` and updated caller in `analyze_entry` to handle all three cases
- `src/lib.rs`: Exported `ScannerError` from the crate

### Testing
- [x] Build passes
- [x] 45 verification unit tests pass
- [x] 14 verification integration tests pass
- [x] All other project tests pass

---
*Solved by Claude Code*
