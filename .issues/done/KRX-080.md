---
id: "KRX-080"
title: "Update get_cli_features to include missing CLI flags"
type: bug
status: in-review
priority: high
labels: ["bug", "comment-rot"]
created: "2026-01-27"
updated: "2026-01-28"
assignee: null
---

# Update get_cli_features to include missing CLI flags

## Problem
The `get_cli_features` function at `main.rs:1008-1022` returns a hardcoded list of CLI flags that is passed to Claude as context for initial release changelog generation. The list is missing `--strict`, `--force`, `--verbose`/`-v`, and `--no-verify`. The `--no-verify` flag was introduced in this very PR but not added to the list.

This is a live instance of comment/documentation rot where the hardcoded list has drifted from the actual `Cli` struct definition just lines above.

## Current Behavior
Claude receives an incomplete list of CLI features, potentially producing inaccurate initial release changelogs that omit new flags.

## Expected Behavior
The feature list should include all CLI flags, or ideally be generated dynamically from the clap `Cli` struct.

## Acceptance Criteria
- [x] Add `--strict`, `--force`, `--verbose`/`-v`, and `--no-verify` to the list
- [x] Or generate the list dynamically from the `Cli` struct (preferred)
- [x] Add a comment noting this list must stay in sync if kept manual

## Technical Notes
- **File:** `src/main.rs:1008-1022`
- Clap provides introspection APIs that could generate this list automatically
- This list is used in `build_prompt` for initial release context

---

## Resolution

**Completed:** 2026-01-28

### Approach
Implemented the **preferred approach** of dynamically generating the CLI features list using clap's `CommandFactory` introspection API, completely eliminating the documentation rot problem.

### Changes Made
- `src/main.rs:8`: Added `CommandFactory` import
- `src/main.rs:992-1018`: Rewrote `get_cli_features()` to use `Cli::command().get_arguments()` for dynamic generation
- `src/main.rs:1024-1046`: Added test `test_get_cli_features_includes_all_flags` to verify all flags are included

### Technical Details
The new implementation:
1. Uses `Cli::command()` to get the clap `Command` object
2. Iterates over all arguments with `get_arguments()`
3. Filters out internal clap arguments (`help`, `version`)
4. Extracts short flag, long flag, and help text for each argument
5. Appends non-flag features (GitHub auth, backup, Unreleased sections)

This ensures any future flags added to the `Cli` struct are automatically included in the feature list passed to Claude.

### Research Sources
- [clap CommandFactory docs](https://docs.rs/clap/latest/clap/trait.CommandFactory.html)
- [clap Command::get_arguments](https://docs.rs/clap/latest/clap/struct.Command.html#method.get_arguments)

### Testing
- [x] Build passes (`cargo build`)
- [x] All 175 tests pass (`cargo test`)
- [x] New test verifies all previously missing flags are now included

---
*Solved by Claude Code*
