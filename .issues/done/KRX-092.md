---
id: "KRX-092"
title: "Sanitize repository_name in version bump prompt"
type: improvement
status: in-review
priority: medium
labels: ["security"]
created: "2026-02-02"
updated: "2026-02-02"
assignee: null
---

# Sanitize repository_name in version bump prompt

## Context
In `build_version_bump_prompt`, commit messages and PR bodies are passed through `sanitize_for_prompt`, but `repository_name` is interpolated directly into the LLM prompt template. While the repo name comes from `get_repo_name` (parsing the git remote URL) and is typically developer-controlled, a maliciously-named repository could inject instructions into the prompt.

## Current Implementation
```rust
r#"You are determining the next semantic version bump for the project "{repo}"."#,
    repo = input.repository_name,  // Not sanitized
```

Commits and PR bodies correctly use `sanitize_for_prompt`:
```rust
sanitize_for_prompt(&format!("{}{}{}", ctype, c.message, breaking))
```

## Proposed Improvement
Pass `input.repository_name` through `sanitize_for_prompt` before interpolation, consistent with how other user-controlled content is handled.

## Acceptance Criteria
- [ ] `repository_name` is passed through `sanitize_for_prompt` before prompt interpolation
- [ ] Existing tests still pass
- [ ] Consistent with how `build_prompt` in `src/llm/prompt.rs` handles repo name (note: that function has the same issue — consider fixing both)

## Technical Notes
- File: `src/version/llm_bump.rs:69`
- `sanitize_for_prompt` is in `src/llm/prompt.rs`
- The existing `build_prompt` in `prompt.rs` has the same pattern for `repo_name` — this is a pre-existing issue
- Flagged by: code-reviewer

---

## Resolution

**Completed:** 2026-02-02

### Approach
Applied `sanitize_for_prompt` to `repository_name` in both prompt-building functions, consistent with how commit messages and PR bodies are already handled.

### Changes Made
- `src/version/llm_bump.rs`: Added `sanitize_for_prompt(input.repository_name)` before interpolation into the version bump prompt (line 76)
- `src/llm/prompt.rs`: Changed `repo_name` from raw `&input.repository_name` to `sanitize_for_prompt(&input.repository_name)` (line 63)

### Testing
- [x] Build passes (cargo build)
- [x] All 347 tests pass (cargo test)
- [x] Existing prompt tests continue to pass (repo names in tests are clean strings, so sanitization is a no-op for them)

---
*Solved by Claude Code*
