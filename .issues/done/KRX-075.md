---
id: "KRX-075"
title: "Unify VerificationError and ScannerError to eliminate duplication"
type: improvement
status: in-review
priority: high
labels: ["code-quality", "error-handling"]
created: "2026-01-27"
updated: "2026-01-27"
assignee: null
---

# Unify VerificationError and ScannerError to eliminate duplication

## Context
Both `VerificationError` and `ScannerError` define variants for the same failure modes (`RipgrepFailed`, `RipgrepNotFound`/`RipgrepNotInstalled`). There is no `From` conversion between them, meaning callers must handle both independently. This creates a confusing API surface and duplicated error messages.

## Current Implementation
```rust
// error.rs - Two overlapping error types
pub enum VerificationError {
    RipgrepNotInstalled,
    RipgrepFailed { exit_code: Option<i32>, stderr: String },
    RipgrepExecutionFailed(String),
}
pub enum ScannerError {
    RipgrepFailed { exit_code: Option<i32>, stderr: String },
    RipgrepNotFound,
    IoError(String),
}
```

Additionally, `ScannerError::IoError(String)` loses the original `std::io::Error` source, unlike patterns elsewhere in the codebase (e.g., `ClaudeError::SpawnFailed(#[source] std::io::Error)`).

## Proposed Improvement
Either:
1. Unify into a single `VerificationError` with all needed variants, or
2. Add `From<ScannerError> for VerificationError` and make `ScannerError` a private implementation detail

Also change `IoError(String)` to `IoError(#[source] std::io::Error)` to preserve the error chain.

## Acceptance Criteria
- [x] Single error type for verification, or clear wrapping relationship
- [x] No duplicate ripgrep-related variants
- [x] `IoError` preserves the source `std::io::Error`
- [x] All error messages remain user-friendly with install instructions
- [x] Public API exports only what consumers need

## Technical Notes
- **File:** `src/error.rs:103-141`
- `ScannerError` is currently only used in `search_keyword` return type
- `VerificationError` is only used in `check_ripgrep_installed`
- Both are re-exported from `lib.rs`

---

## Resolution

**Completed:** 2026-01-27

### Approach
Unified both error types into a single `VerificationError` enum by:
1. Removing `ScannerError` entirely
2. Adding `ScannerIoError(#[source] std::io::Error)` variant to `VerificationError`
3. Updating scanner.rs to use `VerificationError` directly
4. Mapping `ScannerError::RipgrepNotFound` to `VerificationError::RipgrepNotInstalled`

### Changes Made
- `src/error.rs`: Removed `ScannerError` enum, added `ScannerIoError` variant to `VerificationError` with `#[source]` attribute
- `src/verification/scanner.rs`: Changed import and all usages from `ScannerError` to `VerificationError`
- `src/lib.rs`: Removed `ScannerError` from public exports
- `src/main.rs`: Fixed unrelated bug where `check.matches()` returned `Option<bool>` but was used with `!` operator

### Testing
- [x] Build passes (`cargo build`)
- [x] All 168 tests pass (`cargo test`)

---
*Solved by Claude Code*
