---
id: "KRX-063"
title: "Fix debug-level logging hiding stub detection failures"
type: bug
status: done
priority: urgent
labels: ["error-handling", "silent-failure", "critical-gap"]
created: "2026-01-27"
updated: "2026-01-27"
resolved: "2026-01-27"
assignee: null
---

# Fix debug-level logging hiding stub detection failures

## Problem
Errors during stub indicator search are logged at `debug!` level instead of `warn!`. In normal operation (without verbose mode), these errors are completely invisible, causing features with TODO markers to appear "complete" when actually we couldn't check.

## Current Behavior
When stub detection fails (permission errors, ripgrep failures), the error is logged at `debug!` level. Users running without `-v` flag never see these errors. Features with undetected TODO/FIXME markers show `appears_complete: true`, directly undermining the verification feature's purpose.

## Expected Behavior
Unexpected errors during stub detection should be logged at `warn!` level so users are aware of verification gaps. Only expected/benign situations (like file not found due to race conditions) should use `debug!`.

## Steps to Reproduce
1. Run verification on a codebase with permission-denied files
2. Observe no warning in output (only visible with `-v` flag)
3. Note that `appears_complete` may be incorrectly `true` for features in those files

**Environment:** Any environment with files that have restricted permissions

## Acceptance Criteria
- [ ] Unexpected ripgrep exit codes in stub detection are logged at `warn!` level
- [ ] Execution errors in stub detection are logged at `warn!` level
- [ ] Users see warnings when stub detection partially fails

## Technical Notes
**Location:** `src/verification/scanner.rs:442-456`

```rust
// Current problematic code:
Ok(out) => {
    debug!(  // <-- SHOULD BE warn!
        "rg failed searching for stub patterns in '{}': exit code {:?}, stderr: {}",
        ...
    );
}
Err(e) => {
    debug!(  // <-- SHOULD BE warn!
        "Failed to execute rg for stub patterns in '{}': {}",
        file, e
    );
}
```

---

## Resolution

**Completed:** 2026-01-27

### Approach
Changed the two `debug!` log macros in the stub detection error paths to `warn!`, so that unexpected ripgrep failures and execution errors are visible to users without requiring verbose mode.

### Changes Made
- `src/verification/scanner.rs:444`: Changed `debug!` to `warn!` for unexpected rg exit codes
- `src/verification/scanner.rs:452`: Changed `debug!` to `warn!` for rg execution errors

### Testing
- [x] Build passes (`cargo build`)
- [x] All 154 unit tests pass
- [x] All integration tests pass (14 verification, 17 changelog, 8 claude, etc.)
- [ ] Manual testing required (trigger with permission-denied files)

---
*Solved by Claude Code*
