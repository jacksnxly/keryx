---
id: "KRX-020"
title: "Improve update checker error handling and reporting"
type: bug
status: backlog
priority: high
labels: ["silent-failure", "error-handling", "ux"]
created: "2026-01-25"
updated: "2026-01-25"
assignee: null
---

# Improve update checker error handling and reporting

## Problem
The update checker silently treats ALL errors as "no update available." Network errors, authentication failures, version parsing errors, and thread panics all result in the same silent fallback. Users will never know if update checking is broken and could run outdated versions indefinitely.

## Current Behavior
```rust
let result = match check_for_update() {
    Ok(update_available) => UpdateResult { update_available },
    Err(e) => {
        if verbose {
            debug!("Update check failed: {}", e);
        }
        UpdateResult { update_available: false }  // SILENT FALLBACK
    }
};

// Also ignores channel send failures
let _ = sender.send(result);
```

Additionally, `maybe_notify()` silently ignores thread panics:
```rust
fn maybe_notify(&self) {
    if let Ok(result) = self.receiver.try_recv() {
        // ...
    }
    // Silently ignores TryRecvError::Disconnected (thread panic!)
}
```

## Expected Behavior
1. In verbose mode, log specific error types with actionable messages
2. Distinguish between "not finished yet" and "thread failed"
3. Consider showing a brief message if update checking fails repeatedly
4. Log channel disconnection as a warning (indicates thread panic)

## Steps to Reproduce
1. Run keryx with no network connectivity
2. Observe no indication that update check failed
3. Run with `--verbose` and still get minimal info
4. If update thread panics, no indication at all

**Environment:** All platforms, especially offline or restricted network environments

## Acceptance Criteria
- [ ] Verbose mode logs specific error types (network, auth, parse, etc.)
- [ ] Thread panic/disconnection is logged as warning
- [ ] Error messages are actionable (suggest fixes)
- [ ] Consider tracking repeated failures and surfacing a one-time warning
- [ ] Add test for update checker error handling paths

## Technical Notes
**Files:**
- `src/main.rs:47-58` (error handling)
- `src/main.rs:72-81` (maybe_notify)

**Recommended fix for error handling:**
```rust
Err(e) => {
    if verbose {
        match &e {
            UpdateError::Network(_) => debug!("Update check failed: network error - {}", e),
            UpdateError::Parse(_) => debug!("Update check failed: version parse error - {}", e),
            _ => debug!("Update check failed: {}", e),
        }
    }
    UpdateResult { update_available: false }
}
```

**Recommended fix for maybe_notify:**
```rust
fn maybe_notify(&self) {
    match self.receiver.try_recv() {
        Ok(result) if result.update_available => print_update_notification(),
        Ok(_) => {} // No update available
        Err(TryRecvError::Empty) => {} // Not finished yet, expected
        Err(TryRecvError::Disconnected) => {
            tracing::warn!("Update checker thread terminated unexpectedly");
        }
    }
}
```

**Hidden errors this would expose:**
- Network connectivity issues
- axoupdater API failures
- Version parsing errors
- Memory issues causing thread termination
